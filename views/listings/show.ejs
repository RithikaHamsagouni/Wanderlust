<% layout("/layouts/boilerplate") %>

<div class="show-container">
  <div class="listing-card">

    <!-- Image -->
    <img
      src="<%= listing.image?.url || 'https://via.placeholder.com/800x450?text=No+Image' %>"
      alt="<%= listing.title %>"
      class="listing-image"
      onerror="this.src='https://via.placeholder.com/800x450?text=No+Image';"
    />

    <!-- Listing Details -->
    <div class="listing-details">
      <h1 class="listing-title"><%= listing.title %></h1>
      <p class="listing-description"><%= listing.description %></p>

      <!-- Info Grid -->
      <div class="listing-info">
        <div class="info-item">
          <i class="fas fa-rupee-sign info-icon"></i>
          <div class="info-content">
            <div class="info-label">Price per night</div>
            <div class="info-value listing-price">
              â‚¹ <%= listing.price.toLocaleString('en-IN') %>
            </div>
          </div>
        </div>
        <div class="info-item">
          <i class="fas fa-map-marker-alt info-icon"></i>
          <div class="info-content">
            <div class="info-label">Location</div>
            <div class="info-value"><%= listing.location %></div>
          </div>
        </div>
        <div class="info-item">
          <i class="fas fa-globe info-icon"></i>
          <div class="info-content">
            <div class="info-label">Country</div>
            <div class="info-value"><%= listing.country %></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Listing Actions -->
    <div class="listing-actions">
      <div class="left-buttons">
        <a href="/listings/<%= listing._id %>/edit" class="btn-secondary-custom">
          <i class="fas fa-edit me-2"></i>Edit Listing
        </a>

        <form method="POST" action="/listings/<%= listing._id %>?_method=DELETE">
          <button type="submit" class="btn-danger-custom" onclick="return confirm('Are you sure you want to delete this listing?')">
            <i class="fas fa-trash me-2"></i>Delete Listing
          </button>
        </form>
      </div>

      <a href="/listings" class="btn-secondary-custom back-btn">
        <i class="fas fa-arrow-left me-2"></i>Back to Listings
      </a>
    </div>

    <!-- ===== REVIEWS SECTION ===== -->
    <div class="reviews-section">
      <h2>Reviews</h2>

      <!-- Existing Reviews -->
      <% if (listing.reviews && listing.reviews.length > 0) { %>
        <div class="reviews-list">
          <% listing.reviews.forEach(review => { %>
            <div class="review-item">
              <div class="starability-basic" style="justify-content:center; font-size:1.8rem;">
                <% for(let i=1; i<=5; i++) { %>
                  <span style="color: <%= i <= review.rating ? '#ffd700' : '#ddd' %>;">&#9733;</span>
                <% } %>
              </div>
              <p><strong>Comment:</strong> <%= review.comment %></p>
              <form method="POST" action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE" style="display:inline;">
                <button type="submit" class="btn-danger-custom btn-small" onclick="return confirm('Delete this review?')">Delete</button>
              </form>
            </div>
          <% }) %>
        </div>
      <% } else { %>
        <p>No reviews yet. Be the first to review!</p>
      <% } %>

      <!-- Add New Review -->
      <div class="review-form-card">
        <h3>Add a Review</h3>
        <form method="POST" action="/listings/<%= listing._id %>/reviews">

          <!-- Star Rating -->
          <div class="form-group" style="text-align:center; margin-bottom:1rem;">
            <label>Rating</label>
            <div class="starability-basic" style="justify-content:center; font-size:2rem;">
              <input type="radio" id="rate5" name="review[rating]" value="5" required />
              <label for="rate5" title="5 stars"></label>

              <input type="radio" id="rate4" name="review[rating]" value="4" />
              <label for="rate4" title="4 stars"></label>

              <input type="radio" id="rate3" name="review[rating]" value="3" />
              <label for="rate3" title="3 stars"></label>

              <input type="radio" id="rate2" name="review[rating]" value="2" />
              <label for="rate2" title="2 stars"></label>

              <input type="radio" id="rate1" name="review[rating]" value="1" />
              <label for="rate1" title="1 star"></label>
            </div>
          </div>

          <!-- Comment -->
          <div class="form-group">
            <label for="comment">Comment</label>
            <textarea name="review[comment]" id="comment" cols="30" rows="5" class="form-control" required></textarea>
          </div>

          <button type="submit" class="btn-primary-custom">Submit Review</button>
        </form>
      </div>
    </div>
    <!-- ===== END REVIEWS SECTION ===== -->

  </div>
</div>
